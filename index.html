<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ú–æ–π —Å–∞–π—Ç</title>

<style>
body {
    margin: 0;
    font-family: Arial;
}

/* –ü—Ä–∏–º–µ—Ä —Å–∞–π—Ç–∞ */
header {
    background: #222;
    color: white;
    padding: 20px;
    text-align: center;
}

main {
    padding: 20px;
}

/* ===== –ö–ù–û–ü–ö–ê –ß–ê–¢–ê ===== */
#chatButton {
    position: fixed;
    bottom: 20px;
    right: 20px;
    width: 60px;
    height: 60px;
    background: #007bff;
    color: white;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 26px;
    cursor: pointer;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    z-index: 999;
}

/* ===== –û–ö–ù–û –ß–ê–¢–ê ===== */
#chatWidget {
    position: fixed;
    bottom: 90px;
    right: 20px;
    width: 350px;
    height: 500px;
    background: white;
    border-radius: 10px;
    box-shadow: 0 5px 20px rgba(0,0,0,0.3);
    display: none;
    flex-direction: column;
    overflow: hidden;
    z-index: 999;
}

/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */
#chatHeader {
    background: #007bff;
    color: white;
    padding: 12px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

/* –°–æ–æ–±—â–µ–Ω–∏—è */
#chat {
    flex: 1;
    overflow-y: auto;
    padding: 10px;
    background: #f5f5f5;
    font-size: 14px;
}

/* –í–≤–æ–¥ */
#chatInput {
    display: flex;
    border-top: 1px solid #ccc;
}

#msg {
    flex: 1;
    padding: 10px;
    border: none;
    font-size: 14px;
}

#chatInput button {
    padding: 10px 15px;
    border: none;
    background: #007bff;
    color: white;
    cursor: pointer;
}

/* üì± –ú–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è */
@media (max-width: 768px) {
    #chatWidget {
        width: 95%;
        height: 80%;
        right: 2.5%;
        bottom: 80px;
    }
}
</style>
</head>

<body>

<header>
    <h1>–ú–æ–π —Å–∞–π—Ç</h1>
</header>

<main>
    <p>–ó–¥–µ—Å—å –æ–±—ã—á–Ω—ã–π —Å–∞–π—Ç. –ß–∞—Ç –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É –≤–Ω–∏–∑—É.</p>
</main>

<!-- üí¨ –ö–ù–û–ü–ö–ê -->
<div id="chatButton" onclick="toggleChat()">üí¨</div>

<!-- üí¨ –û–ö–ù–û –ß–ê–¢–ê -->
<div id="chatWidget">
    <div id="chatHeader">
        <span>–ü–æ–¥–¥–µ—Ä–∂–∫–∞</span>
        <span style="cursor:pointer;" onclick="toggleChat()">‚úñ</span>
    </div>

    <div id="chat"></div>

    <div id="chatInput">
        <input id="msg" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ">
        <button onclick="sendMessage()">‚û§</button>
    </div>
</div>

<script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>

<script>
// –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –∫–ª–∏–µ–Ω—Ç–∞
const clientId = localStorage.getItem("clientId") || Date.now().toString();
localStorage.setItem("clientId", clientId);

const socket = io("https://g4s-chat-server.onrender.com", {
    query: { clientId }
});

// –û—Ç–∫—Ä—ã—Ç—å/–∑–∞–∫—Ä—ã—Ç—å —á–∞—Ç
function toggleChat() {
    const chat = document.getElementById("chatWidget");
    chat.style.display = chat.style.display === "flex" ? "none" : "flex";
}

// –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
socket.on("loadMessages", (messages) => {
    document.getElementById("chat").innerHTML = "";
    messages.forEach(renderMessage);
});

socket.on("newMessage", renderMessage);

socket.on("updateMessage", (msg) => {
    const div = document.getElementById(msg.id);
    if (div) div.innerHTML = formatMessage(msg);
});

function sendMessage() {
    const input = document.getElementById("msg");
    const text = input.value.trim();
    if (!text) return;

    socket.emit("sendMessage", { text });
    input.value = "";
}

function renderMessage(msg) {
    const div = document.createElement("div");
    div.id = msg.id;
    div.innerHTML = formatMessage(msg);
    document.getElementById("chat").appendChild(div);

    const chat = document.getElementById("chat");
    chat.scrollTop = chat.scrollHeight;
}

function formatMessage(msg) {
    return `<b>${msg.sender}:</b> ${msg.text}`;
}
</script>

</body>
</html>
