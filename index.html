<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chat Support</title>

<style>
body {
    margin: 0;
    font-family: Arial;
    display: flex;
    flex-direction: column;
    height: 100vh;
}

/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */
h2 {
    margin: 0;
    padding: 15px;
    background: #007bff;
    color: white;
    text-align: center;
}

/* –ß–∞—Ç */
#chat {
    flex: 1;
    overflow-y: auto;
    padding: 15px;
    background: #f5f5f5;
    font-size: 16px; /* –∫—Ä—É–ø–Ω–µ–µ —Ç–µ–∫—Å—Ç */
}

/* –°–æ–æ–±—â–µ–Ω–∏–µ */
.message {
    margin-bottom: 12px;
}

/* –ü–æ–ª–µ –≤–≤–æ–¥–∞ */
#inputArea {
    display: flex;
    padding: 10px;
    border-top: 1px solid #ccc;
    background: white;
}

#msg {
    flex: 1;
    padding: 12px;
    font-size: 16px;
}

button {
    padding: 12px 18px;
    font-size: 16px;
    margin-left: 5px;
    background: #007bff;
    color: white;
    border: none;
}

/* üì± –ú–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è */
@media (max-width: 768px) {
    #chat {
        font-size: 18px;
    }

    #msg {
        font-size: 18px;
    }

    button {
        font-size: 18px;
    }
}
</style>
</head>

<body>

<h2>–ß–∞—Ç —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π</h2>

<div id="chat"></div>

<div id="inputArea">
    <input id="msg" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ">
    <button onclick="sendMessage()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
</div>

<script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>

<script>
const clientId = localStorage.getItem("clientId") || Date.now().toString();
localStorage.setItem("clientId", clientId);

const socket = io("https://g4s-chat-server.onrender.com", {
    query: { clientId }
});

socket.on("loadMessages", (messages) => {
    document.getElementById("chat").innerHTML = "";
    messages.forEach(renderMessage);
});

socket.on("newMessage", renderMessage);

socket.on("updateMessage", (msg) => {
    const div = document.getElementById(msg.id);
    if (div) div.innerHTML = formatMessage(msg);
});

function sendMessage() {
    const input = document.getElementById("msg");
    const text = input.value.trim();
    if (!text) return;

    socket.emit("sendMessage", { text });
    input.value = "";
}

function renderMessage(msg) {
    const div = document.createElement("div");
    div.className = "message";
    div.id = msg.id;
    div.innerHTML = formatMessage(msg);
    document.getElementById("chat").appendChild(div);

    // –∞–≤—Ç–æ-–ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –≤–Ω–∏–∑
    const chat = document.getElementById("chat");
    chat.scrollTop = chat.scrollHeight;
}

function formatMessage(msg) {
    return `<b>${msg.sender}:</b> ${msg.text}`;
}
</script>

</body>
</html>
